(function(e,d,a,g){jQuery.fn.centerBlock=function(h){h=h?this.parent():d;this.css({position:"absolute",top:(((e(h).height()-this.outerHeight())/2)+e(h).scrollTop()+"px")});return this};var f=d.Modernizr,c=d.History;e.rgGallery=function(h,i){this.$el=e(i);this._init(h);if(this.options.history){var j=this._imageFromUrl();if(j!==false){this.showGallery(j)}}};e.rgGallery.prototype={_init:function(h){this.options=e.extend({},e.rgGallery.defaults,h),this._config();this._initCarousel();this._initEvents()},_config:function(){this.$items=this.$el.find("li").clone();this.itemsCount=this.$items.length;this.current=0;this.isAnimating=false;this.$rgGallery=e("#rg-gallery").detach();this.$rgImage=this.$rgGallery.find(".rg-image");this.$loader=this.$rgGallery.find(".rg-loading");if(this.itemsCount>1){this.$navPrev=this.$rgGallery.find(".rg-image-nav-prev");this.$navNext=this.$rgGallery.find(".rg-image-nav-next")}if(this.itemsCount<2||!this.options.carousel){this.$rgGallery.css("padding-bottom",50)}if(this.options.history){this._initHistory()}if(this.options.socialLinks){this._initSocial()}},_initHistory:function(){this.timestamps=[];this.pageTitle=a.title;c.Adapter.bind(d,"statechange",e.proxy(function(){var h=c.getState();if(h.data.time in this.timestamps){delete this.timestamps[h.data.time]}else{this.navigate(this._imageFromUrl(),true)}},this))},_imageFromUrl:function(){var h=f.history?d.location.search:d.location.hash;var i=new RegExp(this.options.historyParam+"=(\\d+)").exec(h);if(i){i=parseInt(i[1]);if(i<=this.itemsCount){return i}}return false},_initSocial:function(){this.$rgSocial=this.$rgGallery.find("#rg-social");this.$socialCount=this.$rgSocial.children("ul").socialCount(this.options.socialConfig);this.$rgGallery.addClass("rg-gallery-social")},_initCarousel:function(){if(!this.options.carousel||this.itemsCount<2){return false}this.$rgThumbs=e("#rg-thumbs").detach();if(this.options.dataThumbs){this.$items.each(function(){var i=e(this);i.prop("src",i.data("thumb")).removeProp("data-thumb")})}this.$rgThumbs.find(".es-carousel").append(e("<ul>").append(this.$items));this.$esCarousel=this.$rgThumbs.children(".es-carousel-wrapper").show().elastislide(e.extend({},this.options.elastislide,{onClick:e.proxy(function(i){this.navigate(i.index())},this)}));if(this.options.scroll){this._initSlider()}var h=this.options.thumbsPosition=="top"?"prepend":"append";this.$rgGallery[h](this.$rgThumbs)},_initSlider:function(){this.$esSlider=this.$rgThumbs.appendTo("body").find(".es-scroll").slider({orientation:"horizontal",animate:1000,min:0,value:0,slide:e.proxy(function(i,h){this.$esCarousel.find("ul").css("marginLeft",-h.value)},this)});this.$rgThumbs.detach();e(d).on("resize.rgGallery",e.proxy(function(h){this.$esSlider.slider("option","max",this.$esCarousel.find("ul").width()-this.$esCarousel.width()-13)},this));this.$esCarousel.elastislide("setOption","onBeforeSlide",e.proxy(function(h){if(this.$esSlider){if(typeof h=="string"){var h=-(this.$esSlider.slider("value")-parseInt(h.replace("=","")))}this.$esSlider.slider("value",-h)}},this))},_initEvents:function(){this.$el.on("click.rgGallery","a",e.proxy(function(h){h.preventDefault();this.showGallery(e(h.target).closest("li").index());return false},this));this.$rgGallery.on("click.rgGallery",".rg-close",e.proxy(function(h){this.hideGallery()},this));e(a).on("keyup.rgGallery",e.proxy(function(h){if(h.keyCode==27){this.hideGallery()}},this));e(d).on("resize.rgGallery",e.proxy(function(){this.$rgImage.centerBlock(true)},this));if(this.itemsCount>1){if(this.options.navEvents.arrows){e(a).on("keyup.rgGallery",e.proxy(function(h){if(h.keyCode==39){this.navigate("right")}else{if(h.keyCode==37){this.navigate("left")}}},this))}if(this.options.navEvents.mousewheel){this.$rgImage.on("mousewheel.rgGallery",e.proxy(function(h){if(h.originalEvent.wheelDelta/120>0){this.navigate("left")}else{this.navigate("right")}},this))}if(this.options.navEvents.swipe){this.$rgImage.touchwipe({wipeLeft:e.proxy(function(){this.navigate("right")},this),wipeRight:e.proxy(function(){this.navigate("left")},this),preventDefaultEvents:false})}this.$navPrev.on("click.rgGallery",e.proxy(function(h){this.navigate("left")},this));this.$navNext.on("click.rgGallery",e.proxy(function(h){this.navigate("right")},this))}},showGallery:function(h){if(typeof h==g){h=0}this.$rgGallery.appendTo("body").show();this.navigate(h);e("body").css("overflow","hidden");if(this.options.scroll&&this.options.carousel&&this.itemsCount>1){this.$esSlider.slider("option","max",this.$esCarousel.find("ul").width()-this.$esCarousel.width()-3)}},hideGallery:function(){this.$rgGallery.detach().hide();this.current=0;e("body").css("overflow","");this._pushState(true)},navigate:function(h,i){if(this.isAnimating){return false}this.isAnimating=true;if(typeof h==="number"){this.current=h}else{if(h==="right"){if(this.current+1>=this.itemsCount){this.current=0}else{++this.current}}else{if(h==="left"){if(this.current-1<0){this.current=this.itemsCount-1}else{--this.current}}}}this._showImage(this.$items.eq(this.current));if(this.options.history&&!i){this._pushState()}},_pushState:function(h){var j=new Date().getTime();this.timestamps[j]=j;var i=h?location.pathname:"?image="+this.current;var k=this.title?this.pageTitle+" - "+this.title:this.pageTitle;c.pushState({time:j},k,i)},_showImage:function(h){this.$loader.show();var j=h.find("img"),i=j.data("large");this.title=j.data("description");e("<img/>").load(e.proxy(function(k){this.$rgImage.children("img").replaceWith(k.target);this.$rgImage.children("figcaption").empty().hide();if(this.title){this.$rgImage.children("figcaption").show().text(this.title)}this.$rgImage.centerBlock(true);this.$loader.hide();if(this.options.carousel&&this.itemsCount>1){this.$items.removeClass("selected");h.addClass("selected");this.$esCarousel.elastislide("reload");this.$esCarousel.elastislide("setCurrent",this.current)}this.isAnimating=false},this)).attr("src",i)}};e.rgGallery.defaults={carousel:true,thumbsPosition:"bottom",dataThumbs:false,elastislide:{imageW:65},scroll:true,navEvents:{arrows:true,mousewheel:true,swipe:true},history:true,historyParam:"image",socialLinks:true,socialConfig:{socialSites:["vk","odnoklassniki","facebook","twitter"]}};var b=function(h){if(d.console){d.console.error(h)}};e.fn.rgGallery=function(i){if(typeof i==="string"){var h=Array.prototype.slice.call(arguments,1);this.each(function(){var j=e.data(this,"rgGallery");if(!j){b("cannot call methods on rgGallery prior to initialization; attempted to call method '"+i+"'");return}if(!e.isFunction(j[i])||i.charAt(0)==="_"){b("no such method '"+i+"' for rgGallery instance");return}j[i].apply(j,h)})}else{this.each(function(){var j=e.data(this,"rgGallery");if(j){j._init()}else{j=e.data(this,"rgGallery",new e.rgGallery(i,this))}})}return this}})(jQuery,window,document);